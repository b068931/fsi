$stack-size 512
from prts import <
    io.log.info, 
    pointer.allocate,
    pointer.deallocate, 
    this-thread.dynamic-call
>

function hello-world(pointer the-message)
hello-world {
    $declare pointer null
    void: prts->io.log.info(variable pointer null, immediate eight-bytes 0, variable pointer null, variable pointer the-message)
    the-message: prts->pointer.deallocate()
}

$define-string message ''''Hello World! With extra steps.''''

function main()
main {
    $declare pointer message-storage
    $declare eight-bytes function-address
    
    message-storage: prts->pointer.allocate(size-of message)
    copy-string variable pointer message-storage, string message;

    get-function-address variable eight-bytes function-address, function-name hello-world;
    void: prts->this-thread.dynamic-call(
	    variable eight-bytes function-address, 
	    variable pointer message-storage
    )
}
